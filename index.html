<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Diff Comparison Tool</title>
    <style>
        :root {
            --added-color: #e6ffed;
            --added-border: #34d058;
            --removed-color: #ffeef0;
            --removed-border: #f97583;
            --unchanged-color: #f6f8fa;
            --line-number-color: #6a737d;
            --border-color: #ddd;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            padding: 1rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .button {
            padding: 0.5rem 1rem;
            background-color: #0366d6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #2188ff;
        }

        .button:active {
            background-color: #005cc5;
        }

        .secondary-button {
            background-color: #f1f2f3;
            color: #24292e;
            border: 1px solid #d1d5da;
        }

        .secondary-button:hover {
            background-color: #e6ebf1;
        }

        .input-panels {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            height: 30%;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background-color: #f1f8ff;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
        }

        .panel-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        textarea {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0 0 4px 4px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.85rem;
            resize: none;
            white-space: pre;
            overflow: auto;
        }

        .output-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: white;
        }

        .output-header {
            padding: 0.5rem;
            background-color: #f1f8ff;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .diff-stats {
            font-size: 0.8rem;
            color: var(--line-number-color);
        }

        .diff-container {
            flex: 1;
            overflow: auto;
            position: relative;
        }

        .diff-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.85rem;
            table-layout: fixed;
        }

        .line-number {
            width: 50px;
            text-align: right;
            padding: 0 0.5rem;
            color: var(--line-number-color);
            border-right: 1px solid var(--border-color);
            user-select: none;
            background-color: var(--unchanged-color);
        }

        .diff-content {
            padding: 0 0.5rem;
            white-space: pre;
            overflow: visible;
        }

        .diff-line {
            height: 1.5rem;
        }

        .diff-line:hover {
            background-color: #f0f4f8;
        }

        .added {
            background-color: var(--added-color);
        }

        .added .diff-content {
            border-left: 2px solid var(--added-border);
        }

        .removed {
            background-color: var(--removed-color);
        }

        .removed .diff-content {
            border-left: 2px solid var(--removed-border);
        }

        .diff-char-added {
            background-color: rgba(46, 160, 67, 0.3);
        }

        .diff-char-removed {
            background-color: rgba(248, 81, 73, 0.3);
        }

        /* Responsive styles for desktop */
        @media (min-width: 992px) {
            .container {
                padding: 1.5rem;
            }
        }

        .footer {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--line-number-color);
        }

        .settings-panel {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .settings-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        input[type="checkbox"] {
            cursor: pointer;
        }

        label {
            font-size: 0.9rem;
            cursor: pointer;
        }

        .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Add dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --added-color: #0d1b0d;
                --added-border: #34d058;
                --removed-color: #2d0b0e;
                --removed-border: #f97583;
                --unchanged-color: #161b22;
                --line-number-color: #8b949e;
                --border-color: #30363d;
            }

            body {
                color: #c9d1d9;
                background-color: #0d1117;
            }

            .panel-header, .output-header {
                background-color: #161b22;
            }

            textarea, .output-container {
                background-color: #0d1117;
                color: #c9d1d9;
            }

            .button.secondary-button {
                background-color: #21262d;
                color: #c9d1d9;
                border-color: #30363d;
            }

            .button.secondary-button:hover {
                background-color: #30363d;
            }

            .diff-line:hover {
                background-color: #1c2128;
            }

            .diff-char-added {
                background-color: rgba(46, 160, 67, 0.2);
            }

            .diff-char-removed {
                background-color: rgba(248, 81, 73, 0.2);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Text Diff Comparison Tool</h1>
            <div class="controls">
                <button id="clearBtn" class="button secondary-button">Clear</button>
                <button id="compareBtn" class="button">Compare</button>
            </div>
        </div>

        <div class="settings-panel">
            <div class="settings-group">
                <input type="checkbox" id="ignoreWhitespace" name="ignoreWhitespace" checked>
                <label for="ignoreWhitespace">Ignore whitespace</label>
            </div>
            <div class="settings-group">
                <input type="checkbox" id="ignoreCase" name="ignoreCase">
                <label for="ignoreCase">Ignore case</label>
            </div>
            <div class="settings-group">
                <input type="checkbox" id="inlineChanges" name="inlineChanges" checked>
                <label for="inlineChanges">Show inline changes</label>
            </div>
        </div>

        <div class="input-panels">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Original Text</div>
                    <button id="loadOriginalExample" class="button secondary-button">Load Example</button>
                </div>
                <textarea id="originalText" placeholder="Paste original text here..."></textarea>
            </div>
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Modified Text</div>
                    <button id="loadModifiedExample" class="button secondary-button">Load Example</button>
                </div>
                <textarea id="modifiedText" placeholder="Paste modified text here..."></textarea>
            </div>
        </div>

        <div class="output-container">
            <div class="output-header">
                <div class="panel-title">Diff Result</div>
                <div class="diff-stats" id="diffStats"></div>
            </div>
            <div class="diff-container" id="diffOutput">
                <table class="diff-table" id="diffTable">
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            Text Diff Comparison Tool - Optimized for desktop screens
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff/5.1.0/diff.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const originalTextarea = document.getElementById('originalText');
            const modifiedTextarea = document.getElementById('modifiedText');
            const compareBtn = document.getElementById('compareBtn');
            const clearBtn = document.getElementById('clearBtn');
            const diffOutput = document.getElementById('diffOutput');
            const diffTable = document.getElementById('diffTable').getElementsByTagName('tbody')[0];
            const diffStats = document.getElementById('diffStats');
            const ignoreWhitespace = document.getElementById('ignoreWhitespace');
            const ignoreCase = document.getElementById('ignoreCase');
            const inlineChanges = document.getElementById('inlineChanges');
            const loadOriginalExample = document.getElementById('loadOriginalExample');
            const loadModifiedExample = document.getElementById('loadModifiedExample');

            // Example text for demonstration
            const originalExample = `function calculateTotal(items) {
    let total = 0;
    
    // Loop through all items
    for (let i = 0; i < items.length; i++) {
        // Add the price of each item to the total
        total += items[i].price;
    }
    
    // Return the final total
    return total;
}

// Example usage
const items = [
    { name: 'Book', price: 10.99 },
    { name: 'Pen', price: 1.99 },
    { name: 'Notebook', price: 5.49 }
];

const total = calculateTotal(items);
console.log('Total price:', total);`;

            const modifiedExample = `function calculateTotal(items) {
    let total = 0;
    
    // Loop through items using forEach
    items.forEach(item => {
        // Add the price of each item to the total
        total += item.price;
    });
    
    // Apply discount if total is over $15
    if (total > 15) {
        total *= 0.9; // 10% discount
    }
    
    // Return the final total (rounded to 2 decimal places)
    return parseFloat(total.toFixed(2));
}

// Example usage with tax calculation
const items = [
    { name: 'Book', price: 10.99 },
    { name: 'Pen', price: 1.99 },
    { name: 'Notebook', price: 5.49 },
    { name: 'Highlighter', price: 2.99 }
];

const totalWithDiscount = calculateTotal(items);
console.log('Total price (with discount):', totalWithDiscount);`;

            loadOriginalExample.addEventListener('click', function() {
                originalTextarea.value = originalExample;
            });

            loadModifiedExample.addEventListener('click', function() {
                modifiedTextarea.value = modifiedExample;
            });

            // Function to escape HTML special characters
            function escapeHtml(text) {
                return text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }

            // Function to perform the diff and show the results
            function performDiff() {
                // Get the text from the textareas
                let originalText = originalTextarea.value;
                let modifiedText = modifiedTextarea.value;

                // Apply settings
                if (ignoreWhitespace.checked) {
                    originalText = originalText.replace(/\s+/g, ' ');
                    modifiedText = modifiedText.replace(/\s+/g, ' ');
                }

                if (ignoreCase.checked) {
                    originalText = originalText.toLowerCase();
                    modifiedText = modifiedText.toLowerCase();
                }

                // Show loading indicator
                const loadingElement = document.createElement('div');
                loadingElement.className = 'loading';
                loadingElement.textContent = 'Processing diff...';
                diffOutput.appendChild(loadingElement);

                // Use setTimeout to ensure the UI updates before the heavy computation
                setTimeout(() => {
                    // Clear the table
                    diffTable.innerHTML = '';

                    // Get original and modified lines
                    const originalLines = originalTextarea.value.split('\n');
                    const modifiedLines = modifiedTextarea.value.split('\n');

                    // Calculate diff using diff.js
                    const diff = Diff.diffLines(originalText, modifiedText);

                    // Set up counters for line numbers
                    let originalLineNumber = 1;
                    let modifiedLineNumber = 1;

                    // Initialize counts for statistics
                    let addedCount = 0;
                    let removedCount = 0;
                    let unchangedCount = 0;

                    // Process each diff part
                    diff.forEach(part => {
                        const lines = part.value.split('\n');
                        // The last item might be an empty string if the part ends with a newline
                        if (lines[lines.length - 1] === '') {
                            lines.pop();
                        }

                        lines.forEach(line => {
                            const row = document.createElement('tr');
                            row.className = 'diff-line';
                            
                            if (part.added) {
                                row.className += ' added';
                                row.innerHTML = `
                                    <td class="line-number"></td>
                                    <td class="line-number">${modifiedLineNumber++}</td>
                                    <td class="diff-content">+ ${escapeHtml(line)}</td>
                                `;
                                addedCount++;
                            } else if (part.removed) {
                                row.className += ' removed';
                                row.innerHTML = `
                                    <td class="line-number">${originalLineNumber++}</td>
                                    <td class="line-number"></td>
                                    <td class="diff-content">- ${escapeHtml(line)}</td>
                                `;
                                removedCount++;
                            } else {
                                row.innerHTML = `
                                    <td class="line-number">${originalLineNumber++}</td>
                                    <td class="line-number">${modifiedLineNumber++}</td>
                                    <td class="diff-content">  ${escapeHtml(line)}</td>
                                `;
                                unchangedCount++;
                            }
                            
                            diffTable.appendChild(row);
                        });
                    });

                    // Process inline character-level changes if enabled
                    if (inlineChanges.checked) {
                        processInlineChanges();
                    }

                    // Update statistics
                    diffStats.textContent = `${addedCount} added, ${removedCount} removed, ${unchangedCount} unchanged`;

                    // Remove loading indicator
                    loadingElement.remove();
                }, 50);
            }

            function processInlineChanges() {
                // Get all adjacent added and removed rows
                const rows = Array.from(diffTable.querySelectorAll('tr.diff-line'));
                
                for (let i = 0; i < rows.length; i++) {
                    const currentRow = rows[i];
                    const nextRow = rows[i + 1];
                    
                    if (currentRow.classList.contains('removed') && nextRow && nextRow.classList.contains('added')) {
                        // Get the text content from these rows (remove the first character which is + or -)
                        const removedContent = currentRow.querySelector('.diff-content').textContent.substring(2);
                        const addedContent = nextRow.querySelector('.diff-content').textContent.substring(2);
                        
                        // Perform a character-level diff
                        const charDiff = Diff.diffChars(removedContent, addedContent);
                        
                        // Create new content for the removed line
                        let newRemovedContent = '- ';
                        let newAddedContent = '+ ';
                        
                        charDiff.forEach(part => {
                            if (part.added) {
                                newAddedContent += `<span class="diff-char-added">${escapeHtml(part.value)}</span>`;
                            } else if (part.removed) {
                                newRemovedContent += `<span class="diff-char-removed">${escapeHtml(part.value)}</span>`;
                            } else {
                                newRemovedContent += escapeHtml(part.value);
                                newAddedContent += escapeHtml(part.value);
                            }
                        });
                        
                        // Update the content of the rows
                        currentRow.querySelector('.diff-content').innerHTML = newRemovedContent;
                        nextRow.querySelector('.diff-content').innerHTML = newAddedContent;
                        
                        // Skip the next row since we've already processed it
                        i++;
                    }
                }
            }

            // Event listener for compare button
            compareBtn.addEventListener('click', performDiff);

            // Event listener for clear button
            clearBtn.addEventListener('click', function() {
                originalTextarea.value = '';
                modifiedTextarea.value = '';
                diffTable.innerHTML = '';
                diffStats.textContent = '';
            });

            // Allow comparing on key combination (Ctrl+Enter)
            document.addEventListener('keydown', function(event) {
                if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                    performDiff();
                }
            });

            // Initialize with example data
            originalTextarea.value = originalExample;
            modifiedTextarea.value = modifiedExample;
            performDiff();
        });
    </script>
</body>
</html>
